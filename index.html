<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>유춘자님 회복프로젝트</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background-color: #f3f4f6; }
        input { height: 26px !important; font-size: 11px !important; padding: 0 4px !important; }
        .grid-container { display: grid; gap: 2px; grid-template-columns: 75px repeat(7, minmax(0, 1fr)); min-width: 100%; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const CaregiverScheduler = () => {
            const [schedules, setSchedules] = useState({});
            const [viewMode, setViewMode] = useState('all');
            const [title, setTitle] = useState(localStorage.getItem('pj-title') || '유춘자님 회복프로젝트');
            const [titleInput, setTitleInput] = useState(title);
            const [currentTab, setCurrentTab] = useState('2026-Q1');
            const fileInputRef = useRef(null);

            const timeSlots = [
                { name: '새벽 0-9(9)', hours: 9, color: 'bg-purple-50' }, 
                { name: '오전 9-12(3)', hours: 3, color: 'bg-blue-50' },
                { name: '오후 12-6(6)', hours: 6, color: 'bg-green-50' }, 
                { name: '밤 6-0(6)', hours: 6, color: 'bg-purple-50' }
            ];

            const allWeeks = useMemo(() => {
                const weeks = [];
                let curr = new Date('2025-12-28');
                const end = new Date('2028-12-31');
                const dayLabels = ['일','월','화','수','목','금','토'];
                while (curr <= end) {
                    const days = [];
                    for (let i = 0; i < 7; i++) {
                        days.push({ m: curr.getMonth() + 1, d: curr.getDate(), yo: dayLabels[i], full: `${curr.getFullYear()}-${String(curr.getMonth()+1).padStart(2,'0')}-${String(curr.getDate()).padStart(2,'0')}` });
                        curr.setDate(curr.getDate() + 1);
                    }
                    const q = Math.floor((days[0].m - 1) / 3) + 1;
                    weeks.push({ label: `${days[0].m}/${days[0].d}~${days[6].m}/${days[6].d}`, tabKey: `${new Date(days[0].full).getFullYear()}-Q${q}`, days });
                }
                return weeks;
            }, []);

            const tabs = useMemo(() => [...new Set(allWeeks.map(w => w.tabKey))], [allWeeks]);

            useEffect(() => {
                const data = localStorage.getItem('caregiver-final');
                if (data) {
                    try { setSchedules(JSON.parse(data)); } catch(e) { console.error("Data load error", e); }
                }
                document.title = title;
            }, [title]);

            const save = (targetData = schedules, targetTitle = title) => {
                localStorage.setItem('caregiver-final', JSON.stringify(targetData));
                localStorage.setItem('pj-title', targetTitle);
                alert('저장되었습니다!');
            };

            const exportData = () => {
                const dataStr = JSON.stringify({ title, schedules });
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `caregiver_backup_${new Date().toISOString().slice(0,10)}.json`);
                link.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (imported && typeof imported.schedules === 'object') {
                            setSchedules(imported.schedules);
                            if (imported.title) {
                                setTitle(imported.title);
                                setTitleInput(imported.title);
                            }
                            // 복구 후 사용자 확인을 유도하거나 자동 저장
                            alert('데이터를 성공적으로 읽
